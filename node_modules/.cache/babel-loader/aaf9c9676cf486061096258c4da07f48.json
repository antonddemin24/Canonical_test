{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = require(\"react\");\n\nvar react_dom_1 = require(\"react-dom\");\n\nvar use_ssr_1 = __importDefault(require(\"use-ssr\"));\n\nexports.errorMessage1 = 'You must either add a `ref` to the element you are interacting with or pass an `event` to openPortal(e) or togglePortal(e).';\n\nfunction usePortal(_a) {\n  if (_a === void 0) {\n    _a = {};\n  }\n\n  var _b = _a.closeOnOutsideClick,\n      closeOnOutsideClick = _b === void 0 ? true : _b,\n      _c = _a.closeOnEsc,\n      closeOnEsc = _c === void 0 ? true : _c,\n      bindTo = _a.bindTo,\n      // attach the portal to this node in the DOM\n  _d = _a.isOpen,\n      // attach the portal to this node in the DOM\n  defaultIsOpen = _d === void 0 ? false : _d,\n      onOpen = _a.onOpen,\n      onClose = _a.onClose,\n      onPortalClick = _a.onPortalClick,\n      eventHandlers = __rest(_a, [\"closeOnOutsideClick\", \"closeOnEsc\", \"bindTo\", \"isOpen\", \"onOpen\", \"onClose\", \"onPortalClick\"]);\n\n  var _e = use_ssr_1.default(),\n      isServer = _e.isServer,\n      isBrowser = _e.isBrowser;\n\n  var _f = react_1.useState(defaultIsOpen),\n      isOpen = _f[0],\n      makeOpen = _f[1]; // we use this ref because `isOpen` is stale for handleOutsideMouseClick\n\n\n  var open = react_1.useRef(isOpen);\n  var setOpen = react_1.useCallback(function (v) {\n    // workaround to not have stale `isOpen` in the handleOutsideMouseClick\n    open.current = v;\n    makeOpen(v);\n  }, []);\n  var targetEl = react_1.useRef(); // this is the element you are clicking/hovering/whatever, to trigger opening the portal\n\n  var portal = react_1.useRef(isBrowser ? document.createElement('div') : null);\n  react_1.useEffect(function () {\n    if (isBrowser && !portal.current) portal.current = document.createElement('div');\n  }, [isBrowser, portal]);\n  var elToMountTo = react_1.useMemo(function () {\n    if (isServer) return;\n    return bindTo && react_dom_1.findDOMNode(bindTo) || document.body;\n  }, [isServer, bindTo]);\n\n  var createCustomEvent = function (e) {\n    if (!e) return {\n      portal: portal,\n      targetEl: targetEl,\n      event: e\n    };\n    var event = e || {};\n    if (event.persist) event.persist();\n    event.portal = portal;\n    event.targetEl = targetEl;\n    event.event = e;\n    var currentTarget = e.currentTarget;\n    if (!targetEl.current && currentTarget && currentTarget !== document) targetEl.current = event.currentTarget;\n    return event;\n  }; // this should handle all eventHandlers like onClick, onMouseOver, etc. passed into the config\n\n\n  var customEventHandlers = Object.entries(eventHandlers).reduce(function (acc, _a) {\n    var handlerName = _a[0],\n        eventHandler = _a[1];\n\n    acc[handlerName] = function (event) {\n      if (isServer) return;\n      eventHandler(createCustomEvent(event));\n    };\n\n    return acc;\n  }, {});\n  var openPortal = react_1.useCallback(function (e) {\n    if (isServer) return;\n    var customEvent = createCustomEvent(e); // for some reason, when we don't have the event argument, there\n    // is a weird race condition. Would like to see if we can remove\n    // setTimeout, but for now this works\n\n    if (targetEl.current == null) {\n      setTimeout(function () {\n        return setOpen(true);\n      }, 0);\n      throw Error(exports.errorMessage1);\n    }\n\n    if (onOpen) onOpen(customEvent);\n    setOpen(true);\n  }, [isServer, portal, setOpen, targetEl, onOpen]);\n  var closePortal = react_1.useCallback(function (e) {\n    if (isServer) return;\n    var customEvent = createCustomEvent(e);\n    if (onClose && open.current) onClose(customEvent);\n    if (open.current) setOpen(false);\n  }, [isServer, onClose, setOpen]);\n  var togglePortal = react_1.useCallback(function (e) {\n    return open.current ? closePortal(e) : openPortal(e);\n  }, [closePortal, openPortal]);\n  var handleKeydown = react_1.useCallback(function (e) {\n    return e.key === 'Escape' && closeOnEsc ? closePortal(e) : undefined;\n  }, [closeOnEsc, closePortal]);\n  var handleOutsideMouseClick = react_1.useCallback(function (e) {\n    var containsTarget = function (target) {\n      return target.current.contains(e.target);\n    };\n\n    if (containsTarget(portal) || e.button !== 0 || !open.current || containsTarget(targetEl)) return;\n    if (closeOnOutsideClick) closePortal(e);\n  }, [isServer, closePortal, closeOnOutsideClick, portal]);\n  var handleMouseDown = react_1.useCallback(function (e) {\n    if (isServer || !(portal.current instanceof HTMLElement)) return;\n    var customEvent = createCustomEvent(e);\n    if (portal.current.contains(customEvent.target) && onPortalClick) onPortalClick(customEvent);\n    handleOutsideMouseClick(e);\n  }, [handleOutsideMouseClick]); // used to remove the event listeners on unmount\n\n  var eventListeners = react_1.useRef({});\n  react_1.useEffect(function () {\n    if (isServer) return;\n    if (!(elToMountTo instanceof HTMLElement) || !(portal.current instanceof HTMLElement)) return; // TODO: eventually will need to figure out a better solution for this.\n    // Surely we can find a way to map onScroll/onWheel -> scroll/wheel better,\n    // but for all other event handlers. For now this works.\n\n    var eventHandlerMap = {\n      onScroll: 'scroll',\n      onWheel: 'wheel'\n    };\n    var node = portal.current;\n    elToMountTo.appendChild(portal.current); // handles all special case handlers. Currently only onScroll and onWheel\n\n    Object.entries(eventHandlerMap).forEach(function (_a) {\n      var handlerName = _a[0]\n      /* onScroll */\n      ,\n          eventListenerName = _a[1]\n      /* scroll */\n      ;\n      if (!eventHandlers[handlerName]) return;\n\n      eventListeners.current[handlerName] = function (e) {\n        return eventHandlers[handlerName](createCustomEvent(e));\n      };\n\n      document.addEventListener(eventListenerName, eventListeners.current[handlerName]);\n    });\n    document.addEventListener('keydown', handleKeydown);\n    document.addEventListener('mousedown', handleMouseDown);\n    return function () {\n      // handles all special case handlers. Currently only onScroll and onWheel\n      Object.entries(eventHandlerMap).forEach(function (_a) {\n        var handlerName = _a[0],\n            eventListenerName = _a[1];\n        if (!eventHandlers[handlerName]) return;\n        document.removeEventListener(eventListenerName, eventListeners.current[handlerName]);\n        delete eventListeners.current[handlerName];\n      });\n      document.removeEventListener('keydown', handleKeydown);\n      document.removeEventListener('mousedown', handleMouseDown);\n      elToMountTo.removeChild(node);\n    };\n  }, [isServer, handleOutsideMouseClick, handleKeydown, elToMountTo, portal]);\n  var Portal = react_1.useCallback(function (_a) {\n    var children = _a.children;\n    if (portal.current != null) return react_dom_1.createPortal(children, portal.current);\n    return null;\n  }, [portal]);\n  return Object.assign([openPortal, closePortal, open.current, Portal, togglePortal, targetEl, portal], __assign(__assign({\n    isOpen: open.current,\n    openPortal: openPortal,\n    ref: targetEl,\n    closePortal: closePortal,\n    togglePortal: togglePortal,\n    Portal: Portal,\n    portalRef: portal\n  }, customEventHandlers), {\n    bind: __assign({\n      ref: targetEl\n    }, customEventHandlers)\n  }));\n}\n\nexports.default = usePortal;","map":{"version":3,"mappings":"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","names":["exports","usePortal","_a","_c","closeOnEsc","bindTo","_d","defaultIsOpen","onOpen","onClose","onPortalClick","eventHandlers","isServer","isBrowser","isOpen","makeOpen","open","react_1","setOpen","v","current","targetEl","portal","document","createElement","elToMountTo","react_dom_1","body","createCustomEvent","e","event","persist","currentTarget","customEventHandlers","Object","entries","reduce","acc","handlerName","eventHandler","openPortal","customEvent","setTimeout","Error","closePortal","togglePortal","handleKeydown","key","undefined","handleOutsideMouseClick","containsTarget","target","contains","button","closeOnOutsideClick","handleMouseDown","HTMLElement","eventListeners","eventHandlerMap","onScroll","onWheel","node","appendChild","forEach","eventListenerName","addEventListener","removeEventListener","removeChild","Portal","children","assign","__assign","ref","portalRef","bind"],"sources":["../usePortal.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}